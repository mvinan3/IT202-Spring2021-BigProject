<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <!--<link rel="stylesheet" href="style.css">-->


    <link href="https://unpkg.com/material-components-web@10.0.0/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@10.0.0/dist/material-components-web.min.js">

    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- Include Dexie -->
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>

    <!-- This is to hide the template for the search section CARDS -->
    <style>
        .template {
            display: none;
        }
    </style>

    <!-- for the screnes` -->
    <style>
        .screen {
            display: none;
        }

        body {
            margin: 0;
        }
    </style>

    <!--For the legend-->
    <style>
        #legend {
            font-family: Arial, sans-serif;
            background: #fff;
            padding: 10px;
            margin: 10px;
            border: 3px solid #000;
        }
    </style>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="manifest" href="manifest.json">
    <script>
        //var db = new Dexie("app_db");
        //db.version(1).STORES({
        //    latlng = "names,x,y"
        //});
    </script>
</head>

<body>
    <!-- This part controls the top nav bar-->
    <header class="mdc-top-app-bar mdc-top-app-bar--fixed)">
        <div class="mdc-top-app-bar__row">
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button"
                    aria-label="Open navigation menu">menu</button>
                <span class="mdc-top-app-bar__title">Traffic Camera Locations</span>
            </section>
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button"
                    aria-label="Options">more_vert</button>
            </section>
        </div>
    </header>
    <!--Controls the drop down menu to swithc between screens-->
    <aside class="mdc-drawer mdc-drawer--modal">
        <div class="mdc-drawer__content">
            <nav class="mdc-list">
                <!--screen one or home page is here-->
                <a class="mdc-list-item mdc-list-item--activated" href="#screen1" aria-current="page" tabindex="0">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>
                    <span class="mdc-list-item__text">Home page</span>
                </a>
                <!--second screen-->
                <a class="mdc-list-item" href="#screen2">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">room</i>
                    <span class="mdc-list-item__text">Locations</span>
                </a>
                <!--third screen-->
                <a class="mdc-list-item" href="#screen3">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">feedback</i>
                    <span class="mdc-list-item__text">Weather</span>
                </a>
                <!--fourth screen-->
                <a class="mdc-list-item" href="#screen4">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">description</i>
                    <span class="mdc-list-item__text">About Me</span>
                </a>
            </nav>
        </div>
    </aside>

    <div class="mdc-drawer-scrim"></div>

    <main>
        <main class="mdc-top-app-bar--fixed-adjust">
            <!--something gonna have to go here-->
        </main>
    </main>

    <div id="screen1" class="screen">
        <center>
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h1 class="card-title">Instructions</h1>
                    <p class="card-text">If you're like me and like going fast, not having to worry about remembering
                        where those pesky speed cameras and red light cameras are, then you are at the right place. Just
                        keep the app open as you drive and the app will notify you each time a red-light or speeding
                        camera is coming up. You can also check the weather on the third screen.</p>
                </div>
            </div>
        </center>
    </div>

    <div id="screen2" class="screen">
        <center>
            <!-- google map here-->
            <div id="map" style="width:100%; height: 400px;"></div>
            <div id="getLocation">
                <button type="button">Current Location</button>
            </div>
            <div id="legend">
                <h3>Legend</h3>
            </div>
        </center>
    </div>

    <div id="screen3" class="screen">
        <center>
            <div class="card column" style="width: 18rem;">
                <div class="mdc-card">
                    <div class="mdc-card__primary-action mdc-typography--headline5">
                        <center>
                            <div class="mdc-card mdc-card--outlined">
                                <h1 class="mdc-typography--headline3">Current weather</h1>
                            </div>
                            <p class="mdc-typography--headline4">City:</p>
                            <p class="name mdc-typography--headline6"></p>
                            <p class="mdc-typography--headline4">Temperature in Farenheit:</p>
                            <p class="temp mdc-typography--headline6"></p>
                            <p class="mdc-typography--headline4">Feels like:</p>
                            <p class="feels_like mdc-typography--headline6"></p>
                            <p class="mdc-typography--headline4">Description:</p>
                            <p class="description mdc-typography--headline6"></p>
                        </center>
                    </div>
                </div>
            </div>
        </center>

    </div>

    <div id="screen4" class="screen">
        <center>
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h4 class="card-title">About me</h4>
                    <p class="card-text">I guess this is where i talk about myself \_(-_-)_/</p>
                </div>
                <div class="card-body">
                </div>
            </div>
        </center>
    </div>

    <!--displays the main home page as soon as the app loads and controls switch between screens-->
    <script>
        window.addEventListener("load", (event) => {
            document.querySelector("#screen1").style.display = 'block';
        });

        const screenList = document.querySelector(".mdc-drawer .mdc-list");
        const topNav = document.querySelector('.mdc-top-app-bar');
        const drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
        const mainContentEl = document.querySelector('main');

        screenList.addEventListener("click", (event) => {
            drawer.open = false;
        });

        document.querySelector("header button.mdc-top-app-bar__navigation-icon").addEventListener("click", (event) => {
            drawer.open = true;
        });

        document.body.addEventListener('MDCDrawer:closed', (event) => {
            // mainContentEl.querySelector('input, button').focus();
        });

        // changes screen to desired one from the menu
        document.querySelectorAll('.mdc-list-item').forEach((element) => {
            element.addEventListener('click', (event) => {

                hidescreens();
                let href = event.target.getAttribute("href");
                //console.log(href);
                //console.log(event);
                document.querySelector(href).style.display = "block";

            });
        });

        let hidescreens = () => {
            document.querySelectorAll(".screen").forEach((element) => {
                element.style.display = "none";
            });
        }
    </script>

    <!--controls location screen-->
    <script>
        let map, infoWindow;
        let speedCamera = [];
        let redCamera = [];
        let gL = document.querySelector("#getLocation");

        function initMap() {
            const chi = { lat: 41.8781, lng: -87.6298 };
            const pos = {};
            map = new google.maps.Map(document.querySelector("#map"), {
                center: chi,
                zoom: 15,
            });
            let infowindow = new google.maps.InfoWindow("#map");

            //gets geolocation
            gL.addEventListener("click", () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const pos = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                            };
                            getCameraLocations(pos);
                            map.setCenter(pos);
                            let marker = new google.maps.Marker({
                                position: pos,
                                icon: "http://maps.google.com/mapfiles/kml/pal4/icon57.png",
                                map: map,
                            })
                        },
                        () => {
                            handleLocationError(true, infoWindow, pos);
                        }
                    );
                }
                else {
                    //browser doesnt support geolocation
                    handleLocationError(false, infoWindow, pos);
                }
            })
            var legend = document.querySelector("#legend");
            var div = document.createElement('div');
            var div1 = document.createElement('div');
            var div2 = document.createElement('div');
            div.innerHTML = '<img src="http://maps.google.com/mapfiles/kml/pal4/icon57.png">' + 'your current location';
            div1.innerHTML = '<img src="http://maps.google.com/mapfiles/kml/paddle/ylw-circle-lv.png">' + '   speed camera';
            div2.innerHTML = '<img src="http://maps.google.com/mapfiles/kml/paddle/red-circle-lv.png">' + '   red light camera';
            legend.appendChild(div);
            legend.appendChild(div1);
            legend.appendChild(div2);
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(
                browserHasGeolocation
                    ? "Error: The Geolocation service failed."
                    : "Error: Your Browser doesn't support geolocation."
            );
            infoWindow.open(map);
        }
        //fetches and returns camera locations
        function getCameraLocations(a) {
            let endpoint1 = "https://data.cityofchicago.org/resource/4i42-qv3h.json";
            let endpoint2 = "https://data.cityofchicago.org/resource/thvf-6diy.json";

            let url = endpoint1 + "?$where=within_circle(location, " + a.lat + ", " + a.lng + ", 1000)";
            let url2 = endpoint2 + "?$where=within_circle(location, " + a.lat + ", " + a.lng + ", 1000)";

            var iconBase = "http://maps.google.com/mapfiles/kml/paddle/";

            fetch(url)
                .then((response) => {
                    return response.json();
                })
                .then((data) => {
                    for (let item of data) {
                        let approach = item["first_approach"];
                        let secondApproach = item["second_approach"];
                        const sC = {
                            lat: parseFloat(item["location"]["latitude"]),
                            lng: parseFloat(item["location"]["longitude"])
                        };
                        const infowindow = new google.maps.InfoWindow({
                            content: "Speed Camera pointing towards " + approach + " and " + secondApproach + ".",
                        });
                        let marker = new google.maps.Marker({
                            position: sC,
                            icon: iconBase + "ylw-circle-lv.png",
                            map: map,
                            title: "Speed Camera"
                        });
                        marker.addListener("click", () => {
                            infowindow.open(map, marker);
                        });
                        speedCamera.push(sC);
                    }
                });

            fetch(url2)
                .then((response) => {
                    return response.json();
                })
                .then((data) => {
                    for (let item of data) {
                        let approach = item["first_approach"];
                        let secondApproach = item["second_approach"];
                        const rC = {
                            lat: parseFloat(item["location"]["latitude"]),
                            lng: parseFloat(item["location"]["longitude"])
                        };
                        const infowindow = new google.maps.InfoWindow({
                            content: "Red-light camera pointing towards " + approach + " and " + secondApproach + ".",
                        });
                        let marker = new google.maps.Marker({
                            position: rC,
                            map: map,
                            icon: iconBase + "red-circle-lv.png",
                            title: "Red Light Camera",
                        });
                        marker.addListener("click", () => {
                            infowindow.open(map, marker);
                        });
                        redCamera.push(rC);
                    }
                })
        };

    </script>

    <!--Controls the weather page and alerts-->
    <script>

        let names = document.querySelector(".name");
        let temp = document.querySelector(".temp");
        let feelsLike = document.querySelector(".feels_like");
        let desc = document.querySelector(".description");

        let url3 = "https://api.openweathermap.org/data/2.5/weather?q=Chicago&appid=5a159f09f5fb51cb605939e29e1843f0"

        fetch(url3)
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                let nameVal = data["name"];
                let tempVal = data["main"]["temp"];
                let feelsVal = data["main"]["feels_like"];
                let descVal = data["weather"][0]["description"];

                names.innerHTML = nameVal;
                temp.innerHTML = Math.round((tempVal) - 273.15) * (9 / 5) + (32) + ("F");;
                feelsLike.innerHTML = Math.round((feelsVal) - 273.15) * (9 / 5) + (32) + ("F");
                desc.innerHTML = descVal;

            });
    </script>

    <!--Service worker-->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('sw.js').then(function (registration) {
                    // Registration was successful
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function (err) {
                    // registration failed :(
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        self.addEventListener('install', function (event) {
            // Perform install steps
        });
    </script>


    <!--Async script executes immediately and must be after any DOM elements used in callback-->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9QhM00gFhskAlKweSMhhl0hw37-XKY3k&callback=initMap&libraries=&v=weekly"
        async></script>

</body>

</html>