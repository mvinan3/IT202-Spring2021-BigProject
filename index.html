<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <!--<link rel="stylesheet" href="style.css">-->


    <link href="https://unpkg.com/material-components-web@10.0.0/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@10.0.0/dist/material-components-web.min.js">

    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <!-- This is to hide the template for the search section CARDS -->
    <style>
        .template {
            display: none;
        }
    </style>

    <!-- for the screnes` -->
    <style>
        .screen {
            display: none;
        }

        body {
            margin: 0;
        }
    </style>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- this is for the web manifest -->
    <!--
	<script>
		if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      // registration failed :(
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
	</script>
	<script>
		self.addEventListener('install', function(event) {
  // Perform install steps
});
	</script> -->
</head>

<body>
    <!-- This part controls the top nav bar-->
    <header class="mdc-top-app-bar mdc-top-app-bar--fixed)">
        <div class="mdc-top-app-bar__row">
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button"
                    aria-label="Open navigation menu">menu</button>
                <span class="mdc-top-app-bar__title">Traffic Light Locations</span>
            </section>
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button"
                    aria-label="Options">more_vert</button>
            </section>
        </div>
    </header>

    <aside class="mdc-drawer mdc-drawer--modal">
        <div class="mdc-drawer__content">
            <nav class="mdc-list">
                <!--screen one or home page is here-->
                <a class="mdc-list-item mdc-list-item--activated" href="#screen1" aria-current="page" tabindex="0">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">home</i>
                    <span class="mdc-list-item__text">Home page</span>
                </a>
                <!--second screen-->
                <a class="mdc-list-item" href="#screen2">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">room</i>
                    <span class="mdc-list-item__text">Locations</span>
                </a>
                <!--third screen-->
                <a class="mdc-list-item" href="#screen3">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">feedback</i>
                    <span class="mdc-list-item__text">Weather and Alerts</span>
                </a>
                <!--fourth screen-->
                <a class="mdc-list-item" href="#screen4">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">description</i>
                    <span class="mdc-list-item__text">About Me</span>
                </a>
            </nav>
        </div>
    </aside>

    <div class="mdc-drawer-scrim"></div>

    <main>
        <main class="mdc-top-app-bar--fixed-adjust">
            <!--something gonna have to go here-->
        </main>
    </main>

    <div id="screen1" class="screen">
        <center>
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h1 class="card-title">Instructions</h1>
                    <p class="card-text">Information about how the app works, we will fill this up with lots of infor
                        but right now i just need to fill it in with any typpe of wrtiing so thats what im doen doesnt
                        mater if its misppedled itll be deleted ar one point or another anywards so oh whale hello</p>
                </div>
            </div>
        </center>
    </div>

    <div id="screen2" class="screen">
        <center>
            <!-- google map here-->
            <div id="map" style="width:100%; height: 400px;"></div>
            <div id="currentLocation"></div>
        </center>
    </div>

    <div id="screen3" class="screen">
        <center>
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h3 class="card-title">Weather and alert something</h3>
                    <p class="card-text">Will be adding the map in this area</p>
                </div>
            </div>
        </center>
    </div>

    <div id="screen4" class="screen">
        <center>
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h4 class="card-title">About me</h4>
                    <p class="card-text">I guess this is where i talk about myself \_(-_-)_/</p>
                </div>
            </div>
        </center>
    </div>


    <script>
        // displays the main home page as soon as the app loads
        window.addEventListener("load", (event) => {
            document.querySelector("#screen1").style.display = 'block';
        });

        const screenList = document.querySelector(".mdc-drawer .mdc-list");
        const topNav = document.querySelector('.mdc-top-app-bar');
        const drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
        const mainContentEl = document.querySelector('main');

        screenList.addEventListener("click", (event) => {
            drawer.open = false;
        });

        document.querySelector("header button.mdc-top-app-bar__navigation-icon").addEventListener("click", (event) => {
            drawer.open = true;
        });

        document.body.addEventListener('MDCDrawer:closed', (event) => {
            // mainContentEl.querySelector('input, button').focus();
        });

        // changes screen to desired one off of the menu
        document.querySelectorAll('.mdc-list-item').forEach((element) => {
            element.addEventListener('click', (event) => {

                hidescreens();
                let href = event.target.getAttribute("href");
                //console.log(href);
                //console.log(event);
                document.querySelector(href).style.display = "block";

            });
        });

        let hidescreens = () => {
            document.querySelectorAll(".screen").forEach((element) => {
                element.style.display = "none";
            });
        }
    </script>

    <!--This one controls the map portion of the project-->
    <script>
        let map, infoWindow;
        let currentPos = {};
        let cameraArray = [];

        function initMap() {
            const uic = { lat: 41.8696, lng: -87.6496 };
            const pos = {};
            map = new google.maps.Map(document.querySelector("#map"), {
                center: uic,
                zoom: 15,
            });

            infoWindow = new google.maps.InfoWindow("#map");
            //gonna attempt to make a button that will allow you to show cameras near you at any time

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        },
                            currentPos = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                            };
                        cameraArray = getCameraLocations(currentPos);
                        console.log(typeof(cameraArray));
                        map.setCenter(pos);
                        let marker = new google.maps.Marker({
                            position: pos,
                            map: map,
                        });
                    },
                    () => {
                        handleLocationError(true, infoWindow, map.getCenter());
                    }
                );
            }
            else {
                //browser doesnt support geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(
                browserHasGeolocation
                    ? "Error: The Geolocation service failed."
                    : "Error: Your Browser doesn't support geolocation."
            );
            infoWindow.open(map);
        }
        //fetches and returns camera locations
        function getCameraLocations(a) {

            let lc = [];
            let endpoint1 = "https://data.cityofchicago.org/resource/4i42-qv3h.json";

            let url = endpoint1 + "?$where=within_circle(location, " + a.lat + ", " + a.lng + ", 1000)";

            fetch(url)
                .then((response) => {
                    return response.json();
                })
                .then((data) => {
                    for (let item of data) {
                        const lC = {
                            lat: item["location"]["latitude"],
                            lng: item["location"]["longitude"],
                        };
                        lc.push(lC);
                    }
                });
                console.log(typeof(lc));
            return lc;
        };

    </script>


    <!--Async script executes immediately and must be after any DOM elements used in callback-->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9QhM00gFhskAlKweSMhhl0hw37-XKY3k&callback=initMap&libraries=&v=weekly"
        async></script>

</body>

</html>